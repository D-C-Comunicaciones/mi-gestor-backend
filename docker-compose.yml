services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
      - .env
    environment:
      - NODE_ENV=development
    command: >
      sh -c "npx prisma migrate deploy && npx prisma db seed && node dist/main"
    restart: unless-stopped
    networks:
      - mi-gestor-network
    labels:
      - "traefik.enable=true"

      # Router principal
      - "traefik.http.routers.migestor-api.rule=Host(`rest.dcmigestor.co`)"
      - "traefik.http.routers.migestor-api.entrypoints=websecure"
      - "traefik.http.routers.migestor-api.tls.certresolver=myresolver"

      # Puerto interno del servicio
      - "traefik.http.services.migestor-api.loadbalancer.server.port=3000"


networks:
  mi-gestor-network:
    external: true
